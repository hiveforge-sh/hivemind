---
phase: 02-vault-templates
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - sample-vault/Templates/Character.md
  - sample-vault/Templates/Location.md
  - sample-vault/Templates/Event.md
  - sample-vault/Templates/Faction.md
  - sample-vault/Templates/Lore.md
  - sample-vault/Templates/Asset.md
  - src/types/index.ts
autonomous: true

must_haves:
  truths:
    - "Template files exist for all 6 entity types"
    - "Zod schemas validate Event, Faction, Lore, Asset frontmatter"
    - "Location schema supports hierarchical relationships"
    - "Templates use YAML frontmatter compatible with Obsidian Properties"
  artifacts:
    - path: "sample-vault/Templates/Character.md"
      provides: "Character template with full frontmatter schema"
      contains: "type: character"
    - path: "sample-vault/Templates/Location.md"
      provides: "Location template with hierarchy support"
      contains: "hierarchy_level:"
    - path: "sample-vault/Templates/Event.md"
      provides: "Event template with timeline metadata"
      contains: "type: event"
    - path: "sample-vault/Templates/Faction.md"
      provides: "Faction template with org structure"
      contains: "type: faction"
    - path: "sample-vault/Templates/Lore.md"
      provides: "Lore template for world facts"
      contains: "type: lore"
    - path: "sample-vault/Templates/Asset.md"
      provides: "Asset template for generated images"
      contains: "type: asset"
    - path: "src/types/index.ts"
      provides: "Extended Zod schemas"
      exports: ["EventFrontmatterSchema", "FactionFrontmatterSchema", "LoreFrontmatterSchema", "AssetFrontmatterSchema"]
  key_links:
    - from: "sample-vault/Templates/*.md"
      to: "src/types/index.ts"
      via: "YAML frontmatter field names match Zod schema field names"
      pattern: "type: (event|faction|lore|asset)"
---

<objective>
Create vault templates and extend Zod schemas for all entity types

Purpose: Templates define the metadata schema that canon workflow and asset management depend on. Users need standardized templates to create new entities with consistent structure that the MCP server can index correctly.

Output:
- 6 template files in sample-vault/Templates/
- Extended Zod schemas in src/types/index.ts for Event, Faction, Lore, Asset
- Enhanced Location schema with hierarchy support (parent, children, hierarchy_level)
</objective>

<execution_context>
@C:\Users\Preston\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Preston\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-vault-templates/02-RESEARCH.md

# Existing patterns to follow
@src/types/index.ts
@sample-vault/Characters/Eddard Stark.md
@sample-vault/Locations/Winterfell.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template files for all entity types</name>
  <files>
    sample-vault/Templates/Character.md
    sample-vault/Templates/Location.md
    sample-vault/Templates/Event.md
    sample-vault/Templates/Faction.md
    sample-vault/Templates/Lore.md
    sample-vault/Templates/Asset.md
  </files>
  <action>
Create Templates/ folder in sample-vault with 6 template markdown files.

Each template MUST:
1. Use YAML frontmatter with placeholder syntax compatible with Obsidian core Templates plugin
2. Include all fields from the corresponding Zod schema (see 02-RESEARCH.md for full schemas)
3. Use {{date:YYYY-MM-DD}} for date placeholders (Obsidian native)
4. Quote wikilinks in frontmatter: `parent: "[[Parent Name]]"` (YAML requires quotes for brackets)
5. Include markdown body with section headings appropriate to entity type
6. Keep most fields flat (avoid nested objects) for Obsidian Properties UI compatibility

Template structure per file:

**Character.md**: id, type: character, status: draft, name, age, gender, race, tags, aliases, world, importance, canon_authority, created, updated. Sections: Overview, Appearance, Personality, Background, Relationships, Notes.

**Location.md**: id, type: location, status: draft, name, category (continent|region|settlement|building|room), parent (wikilink to parent location), region (top-level region text), hierarchy_level, climate, terrain[], inhabitants[], children[], connections[], tags, world, importance, created, updated. Sections: Overview, Geography, Demographics, History, Notable Features, Connections, Notes.

**Event.md**: id, type: event, status: draft, name, date, date_start, date_end, date_display, event_type, participants[], locations[], factions[], outcome, consequences[], timeline (wikilink), previous_event, next_event, tags, world, importance, created, updated. Sections: Summary, Participants, Timeline, Outcome, Long-term Impact, Notes.

**Faction.md**: id, type: faction, status: draft, name, faction_type (house|guild|organization|government|military|religion|other), leader (wikilink), members[], headquarters (wikilink), founded, goals[], resources[], allies[], rivals[], tags, world, importance, created, updated. Sections: Overview, Leadership, Goals and Motivations, History, Relationships, Notes.

**Lore.md**: id, type: lore, status: draft, name, category (mythology|history|magic|technology|culture|religion|other), related_entities[], source (in-world|meta|player-knowledge), tags, world, importance, created, updated. Sections: Description, In-World Knowledge, Out-of-World Notes, Related Entries.

**Asset.md**: id, type: asset, status: draft, title, asset_type (image|audio|video|document), file_path, file_format, depicts[], generation_date, generator, workflow_id, prompt, negative_prompt, model, seed, parameters: {}, approved_by, approval_date, tags, world, created, updated. Sections: embedded image via ![[filename]], Generation Details, Usage, Approval Status.

AVOID: Tab indentation (use 2 spaces), unquoted wikilinks, deeply nested YAML objects that break Properties UI.
  </action>
  <verify>
All 6 template files exist in sample-vault/Templates/:
- `ls sample-vault/Templates/` shows Character.md, Location.md, Event.md, Faction.md, Lore.md, Asset.md
- Each file has valid YAML frontmatter (no parse errors)
- Run `npx gray-matter sample-vault/Templates/Character.md` to verify YAML parses correctly
  </verify>
  <done>
6 template files created with complete frontmatter schemas matching 02-RESEARCH.md specifications
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend Zod schemas for new entity types</name>
  <files>src/types/index.ts</files>
  <action>
Add new Zod schemas to src/types/index.ts for Event, Faction, Lore, and Asset entities. Follow the existing pattern used by CharacterFrontmatterSchema and LocationFrontmatterSchema.

Add these schemas after the existing LocationFrontmatterSchema:

1. **EventFrontmatterSchema** - extends BaseFrontmatterSchema:
   - type: z.literal('event')
   - name: z.string()
   - date: z.string().optional() (flexible: ISO or in-world format)
   - date_start: z.string().optional()
   - date_end: z.string().optional()
   - date_display: z.string().optional()
   - event_type: z.string().optional()
   - participants: z.array(z.string()).optional()
   - locations: z.array(z.string()).optional()
   - factions: z.array(z.string()).optional()
   - outcome: z.string().optional()
   - consequences: z.array(z.string()).optional()
   - timeline: z.string().optional()
   - previous_event: z.string().optional()
   - next_event: z.string().optional()

2. **FactionFrontmatterSchema** - extends BaseFrontmatterSchema:
   - type: z.literal('faction')
   - name: z.string()
   - faction_type: z.enum(['house', 'guild', 'organization', 'government', 'military', 'religion', 'other']).optional()
   - leader: z.string().optional()
   - members: z.array(z.string()).optional()
   - headquarters: z.string().optional()
   - founded: z.string().optional()
   - goals: z.array(z.string()).optional()
   - resources: z.array(z.string()).optional()
   - allies: z.array(z.string()).optional()
   - rivals: z.array(z.string()).optional()

3. **LoreFrontmatterSchema** - extends BaseFrontmatterSchema:
   - type: z.literal('lore')
   - name: z.string()
   - category: z.enum(['mythology', 'history', 'magic', 'technology', 'culture', 'religion', 'other']).optional()
   - related_entities: z.array(z.string()).optional()
   - source: z.enum(['in-world', 'meta', 'player-knowledge']).optional()

4. **AssetFrontmatterSchema** - extends BaseFrontmatterSchema:
   - type: z.literal('asset')
   - asset_type: z.enum(['image', 'audio', 'video', 'document']).default('image')
   - file_path: z.string()
   - file_format: z.string().optional()
   - depicts: z.array(z.string()).optional()
   - generation_date: z.string().optional()
   - generator: z.string().optional()
   - workflow_id: z.string().optional()
   - prompt: z.string().optional()
   - negative_prompt: z.string().optional()
   - model: z.string().optional()
   - seed: z.number().optional()
   - parameters: z.record(z.any()).optional()
   - approved_by: z.string().optional()
   - approval_date: z.string().optional()

Also export the inferred types for each schema.

IMPORTANT: Keep existing code intact. Add new schemas in the "Vault Note Types" section after LocationFrontmatterSchema.
  </action>
  <verify>
- `npm run build` succeeds (TypeScript compiles)
- New schemas are exported: grep for "export const EventFrontmatterSchema", etc.
- Types are exported: grep for "export type EventFrontmatter", etc.
  </verify>
  <done>
4 new Zod schemas added to src/types/index.ts: EventFrontmatterSchema, FactionFrontmatterSchema, LoreFrontmatterSchema, AssetFrontmatterSchema. All export types inferred from schemas.
  </done>
</task>

<task type="auto">
  <name>Task 3: Enhance Location schema with hierarchy support</name>
  <files>src/types/index.ts</files>
  <action>
Extend the existing LocationFrontmatterSchema to support hierarchical relationships.

Add these fields to LocationFrontmatterSchema:
- parent: z.string().optional() - wikilink to parent location
- hierarchy_level: z.enum(['continent', 'region', 'settlement', 'building', 'room']).optional()
- children: z.array(z.string()).optional() - wikilinks to child locations

These fields enable:
1. Upward navigation (parent field)
2. Downward navigation (children field)
3. Flat queries by level (hierarchy_level field)
4. All locations stay in flat Locations/ folder (no nested folders)

The existing `region` field (text string) remains for top-level region queries without traversing tree.
  </action>
  <verify>
- `npm run build` succeeds
- LocationFrontmatterSchema includes parent, hierarchy_level, children fields
- grep "hierarchy_level" src/types/index.ts shows the enum
  </verify>
  <done>
LocationFrontmatterSchema enhanced with parent, hierarchy_level, and children fields for hierarchical location support.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Template files exist:
   ```bash
   ls sample-vault/Templates/
   # Should show: Asset.md, Character.md, Event.md, Faction.md, Location.md, Lore.md
   ```

2. TypeScript compiles:
   ```bash
   npm run build
   # Should succeed with no errors
   ```

3. New schemas exported:
   ```bash
   grep "export const.*FrontmatterSchema" src/types/index.ts
   # Should show: BaseFrontmatterSchema, CharacterFrontmatterSchema, LocationFrontmatterSchema,
   #              EventFrontmatterSchema, FactionFrontmatterSchema, LoreFrontmatterSchema, AssetFrontmatterSchema
   ```

4. Template YAML parses correctly:
   ```bash
   node -e "const fm = require('gray-matter'); const fs = require('fs'); const t = fm(fs.readFileSync('sample-vault/Templates/Event.md')); console.log(t.data.type)"
   # Should output: event
   ```
</verification>

<success_criteria>
- 6 template files created in sample-vault/Templates/
- 4 new Zod schemas added to src/types/index.ts (Event, Faction, Lore, Asset)
- LocationFrontmatterSchema enhanced with hierarchy fields
- npm run build succeeds
- Template frontmatter parses without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-vault-templates/02-01-SUMMARY.md`
</output>
