---
phase: 12-setup-wizard
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/cli/init/prompts.ts
  - src/cli/init/detection.ts
  - src/cli/init/wizard.ts
autonomous: true

must_haves:
  truths:
    - "User sees templates grouped by category with description preview"
    - "User can navigate templates with arrow keys and see descriptions"
    - "Vault path input validates on Enter and re-prompts if invalid"
    - "Auto-detection suggests template based on vault folder structure"
    - "Ctrl+C exits wizard gracefully with message"
  artifacts:
    - path: "src/cli/init/prompts.ts"
      provides: "Prompt configurations for vault path and template selection"
      exports: ["promptVaultPath", "promptTemplateSelection", "promptConfirm", "TEMPLATE_CHOICES"]
    - path: "src/cli/init/detection.ts"
      provides: "Wrapper around existing TemplateDetector with confirmation flow"
      exports: ["detectAndConfirmTemplate"]
    - path: "src/cli/init/wizard.ts"
      provides: "Main wizard orchestrator"
      exports: ["runInteractiveWizard"]
  key_links:
    - from: "src/cli/init/wizard.ts"
      to: "src/cli/init/prompts.ts"
      via: "import"
      pattern: "import.*from.*prompts"
    - from: "src/cli/init/wizard.ts"
      to: "src/cli/init/detection.ts"
      via: "import"
      pattern: "import.*from.*detection"
    - from: "src/cli/init/detection.ts"
      to: "src/templates/detector.ts"
      via: "TemplateDetector import"
      pattern: "import.*TemplateDetector.*from.*templates/detector"
---

<objective>
Create the core interactive wizard with template selection, vault path input, and auto-detection.

Purpose: Implements the main user-facing interactive experience for setup.
Output: Wizard orchestrator that guides users through setup with grouped templates and auto-detection.
</objective>

<execution_context>
@C:\Users\Preston\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Preston\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-setup-wizard/12-CONTEXT.md
@.planning/phases/12-setup-wizard/12-RESEARCH.md
@src/cli/shared/colors.ts
@src/cli/init/validators.ts
@src/templates/detector.ts
@src/templates/builtin/worldbuilding.ts
@src/templates/builtin/research.ts
@src/templates/builtin/people-management.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create prompts module with template selection</name>
  <files>src/cli/init/prompts.ts</files>
  <action>
Create src/cli/init/prompts.ts with prompt configurations using @inquirer/prompts:

```typescript
import { input, select, confirm, Separator } from '@inquirer/prompts';
import { resolve } from 'path';
import { validateVaultPath } from './validators.js';
import { success, dim, bold } from '../shared/colors.js';

/**
 * Template choices grouped by category with descriptions.
 * Descriptions appear below the list as user navigates.
 */
export const TEMPLATE_CHOICES = [
  new Separator(dim('--- Creative ---')),
  {
    name: 'Worldbuilding',
    value: 'worldbuilding',
    description: 'Fiction, games, RPGs - characters, locations, events, factions, lore, assets',
  },
  new Separator(dim('--- Professional ---')),
  {
    name: 'People Management',
    value: 'people-management',
    description: 'Teams, HR - people, goals, teams, 1:1 meetings',
  },
  new Separator(dim('--- Technical ---')),
  {
    name: 'Software Architecture',
    value: 'software-architecture',
    description: 'Engineers - systems, ADRs, components, integrations',
  },
  {
    name: 'UX Research',
    value: 'ux-research',
    description: 'UX, product - interviews, insights, personas, journeys',
  },
  new Separator(dim('--- Research ---')),
  {
    name: 'Research',
    value: 'research',
    description: 'Academic, knowledge - papers, citations, concepts, notes',
  },
  new Separator(dim('--- Custom ---')),
  {
    name: 'Create custom template...',
    value: 'custom',
    description: 'Define your own entity types and relationships',
  },
];

/**
 * Prompt for vault path with validation.
 * Validates on Enter, re-prompts if invalid.
 */
export async function promptVaultPath(defaultPath?: string): Promise<string> {
  const vaultPath = await input({
    message: 'Enter your Obsidian vault path:',
    default: defaultPath || process.cwd(),
    validate: validateVaultPath,
  });

  return resolve(vaultPath.trim());
}

/**
 * Prompt for template selection with grouped categories.
 */
export async function promptTemplateSelection(): Promise<string> {
  return await select({
    message: 'Select a template for your vault:',
    choices: TEMPLATE_CHOICES,
  });
}

/**
 * Prompt for yes/no confirmation.
 */
export async function promptConfirm(message: string, defaultValue = true): Promise<boolean> {
  return await confirm({
    message,
    default: defaultValue,
  });
}

/**
 * Prompt for overwriting existing config.
 */
export async function promptOverwriteConfig(): Promise<boolean> {
  return await confirm({
    message: 'config.json already exists. Overwrite?',
    default: false,
  });
}
```

Key patterns from RESEARCH.md:
- select() with description field enables preview on highlight
- Separator for category grouping
- validate function returns true or error string
  </action>
  <verify>
File exists at src/cli/init/prompts.ts.
TypeScript compilation succeeds: npm run build
  </verify>
  <done>
prompts.ts exports TEMPLATE_CHOICES, promptVaultPath, promptTemplateSelection, promptConfirm, promptOverwriteConfig.
Templates are grouped by category with Separator.
Each template has description for inline preview.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create detection wrapper with confirmation</name>
  <files>src/cli/init/detection.ts</files>
  <action>
Create src/cli/init/detection.ts that wraps existing TemplateDetector with confirmation flow:

```typescript
import { TemplateDetector } from '../../templates/detector.js';
import { promptConfirm, promptTemplateSelection } from './prompts.js';
import { bold, dim } from '../shared/colors.js';

/**
 * Detect template from vault structure and confirm with user.
 *
 * Flow:
 * 1. Scan vault for folder patterns
 * 2. If match found with medium/high confidence, ask user to confirm
 * 3. If user declines or no match, fall through to manual selection
 *
 * @param vaultPath - Absolute path to vault directory
 * @returns Selected template ID
 */
export async function detectAndConfirmTemplate(vaultPath: string): Promise<string> {
  const detector = new TemplateDetector();
  const detection = await detector.detectTemplate(vaultPath);

  // If detection found with reasonable confidence
  if (detection && detection.confidence !== 'low') {
    console.log(`\nDetected: ${bold(detection.templateId)} template`);
    console.log(dim(`Matched folders: ${detection.matchedPatterns.join(', ')}`));
    console.log(dim(`Confidence: ${detection.confidence}`));

    const useDetected = await promptConfirm(
      `Use ${detection.templateId} template?`,
      true
    );

    if (useDetected) {
      return detection.templateId;
    }
  }

  // Fall through to manual selection
  return await promptTemplateSelection();
}

/**
 * Check if vault has recognizable folder structure.
 * Used to determine whether to offer creating recommended folders.
 */
export async function hasRecognizableFolders(vaultPath: string): Promise<boolean> {
  const detector = new TemplateDetector();
  const detection = await detector.detectTemplate(vaultPath);
  return detection !== null;
}
```

This reuses the existing TemplateDetector from src/templates/detector.ts.
  </action>
  <verify>
File exists at src/cli/init/detection.ts.
TypeScript compilation succeeds: npm run build
  </verify>
  <done>
detection.ts exports detectAndConfirmTemplate and hasRecognizableFolders.
Uses existing TemplateDetector class.
Confirms detected template with user before using it.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create wizard orchestrator</name>
  <files>src/cli/init/wizard.ts</files>
  <action>
Create src/cli/init/wizard.ts - the main wizard orchestrator:

```typescript
import { ExitPromptError } from '@inquirer/prompts';
import { promptVaultPath, promptOverwriteConfig, promptConfirm } from './prompts.js';
import { detectAndConfirmTemplate } from './detection.js';
import { configExists } from './validators.js';
import { success, error, dim, bold } from '../shared/colors.js';

/**
 * Breadcrumb steps for progress display.
 */
const STEPS = ['Vault', 'Template', 'Config', 'Done'];

/**
 * Render breadcrumb progress indicator.
 */
function renderBreadcrumb(current: number): string {
  return STEPS.map((step, i) => {
    if (i < current) return dim(step);
    if (i === current) return bold(step);
    return dim(step);
  }).join(dim(' > '));
}

/**
 * Result of interactive wizard.
 */
export interface WizardResult {
  vaultPath: string;
  templateId: string;
  cancelled: boolean;
}

/**
 * Run the interactive setup wizard.
 *
 * Flow:
 * 1. Check for TTY (bail if non-interactive)
 * 2. Check for existing config.json (prompt to overwrite)
 * 3. Prompt for vault path
 * 4. Auto-detect template or manual selection
 * 5. Return result for config generation
 *
 * @returns Wizard result with vault path and template ID
 */
export async function runInteractiveWizard(): Promise<WizardResult> {
  // Check for TTY before prompts
  if (!process.stdin.isTTY) {
    console.error(error('Interactive mode requires a terminal.'));
    console.error('Use --config <preset.json> or flags for non-interactive mode.');
    process.exit(1);
  }

  try {
    console.log('\n' + bold('Hivemind Setup Wizard'));
    console.log('=' .repeat(40) + '\n');

    // Step 1: Check for existing config
    const cwd = process.cwd();
    if (configExists(cwd)) {
      const overwrite = await promptOverwriteConfig();
      if (!overwrite) {
        console.log('\nSetup cancelled.');
        return { vaultPath: '', templateId: '', cancelled: true };
      }
    }

    // Step 2: Vault path
    console.log('\n' + renderBreadcrumb(0));
    const vaultPath = await promptVaultPath();
    console.log(success(`Using vault: ${vaultPath}`));

    // Step 3: Template selection (with auto-detection)
    console.log('\n' + renderBreadcrumb(1));
    let templateId = await detectAndConfirmTemplate(vaultPath);

    // Handle custom template selection
    if (templateId === 'custom') {
      console.log('\n' + dim('Custom template creation will be available after initial setup.'));
      console.log(dim('For now, starting with worldbuilding template. Run create-template later.'));
      templateId = 'worldbuilding';
    }

    console.log(success(`Using template: ${templateId}`));

    // Step 4: Complete
    console.log('\n' + renderBreadcrumb(3));

    return {
      vaultPath,
      templateId,
      cancelled: false,
    };

  } catch (err) {
    // Handle Ctrl+C gracefully
    if (err instanceof ExitPromptError) {
      console.log('\n\nSetup cancelled.');
      return { vaultPath: '', templateId: '', cancelled: true };
    }
    throw err;
  }
}
```

Key patterns from RESEARCH.md:
- Check process.stdin.isTTY before prompts
- Catch ExitPromptError for Ctrl+C handling
- Breadcrumb progress display
  </action>
  <verify>
File exists at src/cli/init/wizard.ts.
TypeScript compilation succeeds: npm run build
  </verify>
  <done>
wizard.ts exports WizardResult interface and runInteractiveWizard function.
Checks for TTY before prompts.
Handles Ctrl+C with ExitPromptError.
Shows breadcrumb progress.
Returns vaultPath, templateId, and cancelled status.
  </done>
</task>

</tasks>

<verification>
1. npm run build - compiles without errors
2. All files exist: src/cli/init/prompts.ts, detection.ts, wizard.ts
3. Imports resolve correctly (no "module not found" errors)
</verification>

<success_criteria>
- prompts.ts created with TEMPLATE_CHOICES grouped by category
- Template descriptions appear in select choices
- detection.ts wraps existing TemplateDetector with user confirmation
- wizard.ts orchestrates the flow: TTY check -> vault path -> template -> result
- Ctrl+C handled gracefully with ExitPromptError
- Breadcrumb progress display works
- TypeScript build passes
</success_criteria>

<output>
After completion, create `.planning/phases/12-setup-wizard/12-02-SUMMARY.md`
</output>
