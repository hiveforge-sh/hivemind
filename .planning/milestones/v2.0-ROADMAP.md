# Milestone v2.0: Template System

**Status:** ✅ SHIPPED 2026-01-26
**Phases:** 6-11
**Total Plans:** 12

## Overview

Transform Hivemind from a worldbuilding-specific tool into a general-purpose domain-agnostic system. The hardcoded worldbuilding schemas were extracted into a template definition, allowing users to define custom entity types via config.json without coding. Built-in templates (worldbuilding, research, people-management) ship with the system, and MCP tools are auto-generated per entity type. Custom relationship types enable domain-specific semantics. Full backwards compatibility ensures existing worldbuilding vaults work unchanged.

## Phases

### Phase 6: Template Infrastructure Core

**Goal**: Foundation for pluggable template system with config-driven entity definitions
**Depends on**: Nothing (first phase of v2.0)
**Plans**: 5 plans

Plans:
- [x] 06-01-PLAN.md — Template types and interfaces
- [x] 06-02-PLAN.md — Template registry and config validation
- [x] 06-03-PLAN.md — Schema factory (Zod generation from config)
- [x] 06-04-PLAN.md — Config loading and worldbuilding template
- [x] 06-05-PLAN.md — Server startup integration

**Deliverables:**
- Template type definitions with field configs
- Dynamic Zod schema generation from config
- Built-in worldbuilding template with all v1.0 entity types
- Config loader with validation
- Server startup integration

---

### Phase 7: Migration

**Goal**: Extract hardcoded worldbuilding to template system, validate architecture with real code
**Depends on**: Phase 6
**Plans**: 5 plans

Plans:
- [x] 07-01-PLAN.md — Template detector and database metadata
- [x] 07-02-PLAN.md — Database schema migration (template_id column)
- [x] 07-03-PLAN.md — Snapshot tests for v1.0 parity
- [x] 07-04-PLAN.md — Generic query_entity and tool deprecation
- [x] 07-05-PLAN.md — Integration verification and test updates

**Deliverables:**
- Template detector for auto-detecting vault type
- Database schema v2.0 with template_id column
- Snapshot tests ensuring v1.0 parity
- Generic query_entity replacing type-specific handlers
- 175 tests passing

---

### Phase 8: Dynamic MCP Tools

**Goal**: Auto-generate MCP tools for each entity type defined in active template
**Depends on**: Phase 7
**Plans**: 1 plan

Plans:
- [x] 08-01-PLAN.md — Tool generator implementation

**Deliverables:**
- Tool generator module (generateQueryTool, generateListTool)
- 16 dynamic tools for worldbuilding template (8 entity types × 2 tools)
- Template-specific tool descriptions
- Generic handlers for query/list operations
- 38 new tests

---

### Phase 9: Relationship System

**Goal**: Support custom relationship types per template with validation
**Depends on**: Phase 8
**Plans**: None (Copilot-implemented)

**Deliverables:**
- RelationshipTypeConfig interface with source/target constraints
- Registry methods for relationship type queries
- Graph builder uses template-based relationship inference
- Bidirectional relationships with automatic reverse edges
- Search engine supports relationshipType filter
- 44 new tests

---

### Phase 10: Built-in Templates

**Goal**: Ship production-ready templates for worldbuilding, research, and people-management domains
**Depends on**: Phase 9
**Plans**: None (Copilot-implemented)

**Deliverables:**
- Research template (paper, citation, concept, note)
- People-management template (person, goal, team, one_on_one)
- Sample vaults for all three templates
- Loader updated to register all built-in templates
- 22 new tests

---

### Phase 11: Server Template Integration Fix (GAP CLOSURE)

**Goal**: Restore template initialization in server startup to activate all v2.0 features
**Depends on**: Phases 6-10
**Plans**: 1 plan

Plans:
- [x] 11-01-PLAN.md — Add initializeTemplates() call and integration test

**Deliverables:**
- initializeTemplates() called at server startup
- Template registry populated with worldbuilding by default
- All 16 dynamic MCP tools available at runtime
- Integration test for server template initialization
- FTS5 empty query bug fix

---

## Milestone Summary

**Key Decisions:**
- Deprecation via _meta field in responses (MCP SDK lacks native deprecation)
- Template detection before initialization (auto-detect from vault structure)
- Generic query_entity with type parameter (foundation for dynamic tools)
- Sunset date 2027-01-01 for deprecated tools (one year migration window)
- Template ID defaults to 'worldbuilding' (backwards compatibility)
- Initialize templates before vault scan (templates needed before entity parsing)
- Wrap template init in try-catch (backwards compatibility for vaults without config)

**Issues Resolved:**
- Context overflow at 100+ phases (archive system)
- FTS5 syntax error on empty query (bypass for list operations)
- Template registry empty at runtime (server integration fix)

**Issues Deferred:**
- Template marketplace/sharing (focus on core system first)
- Template inheritance (added complexity)
- Multi-template vaults (one template per vault simpler for v2.0)

**Technical Debt Incurred:**
- Some workflows still reference hardcoded paths (acceptable for now)
- Deprecated tools maintained for backwards compatibility until v3.0

---

_For current project status, see .planning/ROADMAP.md_
